ENEXA_SHARED_DIRECTORY= A demo application for the ENEXA Knowledge Extraction use case

image::./images/screenshot.png[]

== Installation

```bash
pip install -r requirements.txt
```

== Configuration

The application needs to know where the ENEXA service is running, etc. 
To do so, you need to set the environment variable `ENEXA_SERVICE_URL` to the URL of the service. 

The following parameters are required and can be defined in the link:./.env[`.env`] file or as environment variables:

* `SERVER_ENDPOINT`
* `ENEXA_SHARED_DIRECTORY`
* `SLEEP_IN_SECONDS`
* `META_DATA_ENDPOINT`
* `META_DATA_GRAPH_NAME`
* `EMBEDDINGS_BATCH_SIZE`
* `EMBEDDINGS_DIM`
* `EMBEDDINGS_EPOCH_NUM`
* `DATASET_NAME`
* `DATASET_NAME_TENTRIS`

Note, for all of these variables defaults are defined in the link:./app.py[app.py] that are intended to be used for development purposes only.

== Usage

```bash
streamlit run app.py
```

If you worked on the localhost and everything went well, you should see a frontend at http://localhost:8501.

== Docker

You can also run the application in a Docker container. To do so, you need to build the Docker image first:

```bash
docker build -t enexa-knowledge-extraction-demo:latest .
```

Then you can run the container:

```bash
docker run -p 8501:8501 enexa-knowledge-extraction-demo:latest
```

== For Developers

If you want to develop on the frontend, you can use the following commands to start the required services:

* Start the Fuseki triplestore, cf. https://github.com/EnexaProject/enexa-service/tree/develop-implementService-startContainer#triplestore
* Start the ENEXA service, cf. https://github.com/EnexaProject/enexa-service/tree/develop-implementService-startContainer#starting-the-enexa-service

== Run the Demo with All Containers
If you want to run this demo as a container on the VM, follow these steps

* Pull all required Docker images:

    docker pull hub.cs.upb.de/enexa/images/enexa-cel-deploy-module:1.0.0
    docker pull hub.cs.upb.de/enexa/images/enexa-cel-train-module:1.0.0
    docker pull hub.cs.upb.de/enexa/images/enexa-dice-embeddings:1.0.1
    docker pull hub.cs.upb.de/enexa/images/enexa-extraction-module:1.0.0
    docker pull hub.cs.upb.de/enexa/images/enexa-kg-fixing-module:1.0.0
    docker pull hub.cs.upb.de/enexa/images/enexa-tentris-module:0.2.0-SNAPSHOT-1
    docker pull hub.cs.upb.de/enexa/enexa-transform-module:0.0.1


Run the following bash script (`download-module-files.sh`) for downloading the required metadata. then copy all downloaded files in the directory `/data/enexa/metadata`, or create an equivalent directory for the next steps.

* Create a Docker Network:

    Execute the following command to create a Docker network:

    docker network create -d enexaNet .


* Run the Metadata Triple Store:

   Ensure that the path `/data/fusekiData` exists or replace it with a valid path. Then, run the following command:

   ```bash
   sudo docker run -d --name fuseki-devwd --network enexaNet -p 3030:3030 -e ADMIN_PASSWORD=[password] -v /data/fusekiData:/fuseki stain/jena-fuseki
   ```

* Access the Fuseki Web Console:

   Open the Fuseki web console at port 3030. Use the following credentials to log in:
   - Username: admin
   - Password: [password]

   Add a new dataset (e.g., `mydataset`) with the desired dataset name.

* Run the Enexa Service Image:

   Run the Enexa service image with the following command. Make sure the paths are valid or replace them with valid ones:


   sudo docker run -d --name enexaservice --network enexaNet -v /data/enexa/shared:/home/shared -v /var/run/docker.sock:/var/run/docker.sock -v /data/enexa/metadata:/home/metadata -e ENEXA_META_DATA_ENDPOINT=[metadata store endpoint]/[dataset name] -e ENEXA_META_DATA_GRAPH=[graph name] -e ENEXA_MODULE_DIRECTORY=/home/metadata -e ENEXA_RESOURCE_NAMESPACE=http://example.org/enexa/ -e ENEXA_SERVICE_URL=http://enexaservice:8080/ -e ENEXA_SHARED_DIRECTORY=/data/enexa/shared -e DOCKER_NET_NAME=enexaNet hub.cs.upb.de/enexa/images/enexa-service-demo:1.0.0


* Copy Required Files to the Shared Directory: (from here : https://files.dice-research.org/projects/ENEXA/FirstDemoFiles/)

   ** `generation_parameters.json`
   ** `wikidata5M.ttl.gz`
   ** `wikidata5M.nt`
   ** `Keci_entity_embeddings.csv`
   ** `1-ontology_version_1.ttl`

* Run the Demo Container:

   You can run the demo container either using a Docker Compose file or a Docker run command.

   ** Using Docker Compose:

   Create a `docker-compose.yml` file with the following content:

   version: "3.0"
   services:
     demo:
       image: hub.cs.upb.de/enexa/images/enexa-ui-demo:1.0.0-tentris-demo
       ports:
         - "8080:8501"
       volumes:
         - type: bind
           source: /data/enexa/shared
           target: /home/shared
         - /var/run/docker.sock:/var/run/docker.sock
       environment:
         - SERVER_ENDPOINT=http://enexaservice:8080
         - META_DATA_ENDPOINT=http://fuseki-devwd:3030/mydataset
         - ENEXA_SHARED_DIRECTORY=/home/shared
         - DATASET_NAME_TENTRIS=wikidata5M.nt
       networks:
         - enexaNet
   networks:
     enexaNet:
       external: true
       name: enexaNet

   Then, run the following command to start the demo:

   docker-compose up -d

   ** Using Docker Run:

   Run the demo container with the following command:

   sudo docker run -d -p 8080:8501 --network enexaNet -v /data/enexa/shared:/home/shared hub.cs.upb.de/enexa/images/enexa-ui-demo:1.0.0-tentris-demo

== one docker-compose file 
you can use this as a docker-compose file, update the paths if need

```
version: "3.0"
services:
  fuseki-devwd:
    image: stain/jena-fuseki
    container_name: fuseki-devwd
    networks:
      - enexaNet
    ports:
      - "3030:3030"
    environment:
      ADMIN_PASSWORD: pw123
    volumes:
      - /data/fusekiData:/fuseki
  enexaservice:
    image: hub.cs.upb.de/enexa/images/enexa-service-demo:1.0.0
    container_name: enexaservice
    networks:
      - enexaNet
    volumes:
      - /data/enexa/shared:/home/shared
      - /var/run/docker.sock:/var/run/docker.sock
      - /data/enexa/metadata:/home/metadata
    environment:
      - ENEXA_META_DATA_ENDPOINT=http://fuseki-devwd:3030/mydataset
      - ENEXA_META_DATA_GRAPH=http://example.org/meta-data
      - ENEXA_MODULE_DIRECTORY=/home/metadata
      - ENEXA_RESOURCE_NAMESPACE=http://example.org/enexa/
      - ENEXA_SERVICE_URL=http://enexaservice:8080/
      - ENEXA_SHARED_DIRECTORY=/data/enexa/shared
      - DOCKER_NET_NAME=enexaNet
  demo:
    image: hub.cs.upb.de/enexa/images/enexa-ui-demo:1.0.0-tentris-demo
    ports:
      - "8080:8501"
    volumes:
      - type: bind
        source: /data/enexa/shared
        target: /home/shared
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - SERVER_ENDPOINT=http://enexaservice:8080
      - META_DATA_ENDPOINT=http://fuseki-devwd:3030/mydataset
      - ENEXA_SHARED_DIRECTORY=/home/shared
      - DATASET_NAME_TENTRIS=wikidata5M.nt
    networks:
      - enexaNet

networks:
  enexaNet:
    driver: bridge
```
